version: "3.4"
services:
  master:
    container_name: "master"
    networks:
      - rosnet
    image: ros:melodic-ros-core
    command: roscore

  rosdetector:
    container_name: "rosdetector"
    networks:
      - rosnet
    depends_on:
      - master
    build: 
      context: .
      target: rosdetector
    environment:
      - "ROS_HOSTNAME=rosdetector"
      - "ROS_MASTER_URI=http://master:11311"
    tty: True

  rosinput:
    container_name: "rosinput"
    networks:
      - rosnet
    depends_on:
      - master
    build:
      context: .
      target: rosinput
    environment:
      - "ROS_HOSTNAME=rosinput"
      - "ROS_MASTER_URI=http://master:11311"
    stdin_open: true
    tty: true

  rosprinter:
    container_name: "rosprinter"
    networks:
      - rosnet
    depends_on:
      - master
    build:
      context: .
      target: rosprinter
    environment:
      - "ROS_HOSTNAME=rosprinter"
      - "ROS_MASTER_URI=http://master:11311"
    logging:
      driver: none
    tty: true
    stdin_open: true

  roscamera:
    container_name: "roscamera"
    networks:
      - rosnet
    depends_on:
      - master
    build:
      context: .
      target: roscamera
    environment:
      - "ROS_HOSTNAME=roscamera"
      - "ROS_MASTER_URI=http://master:11311"
    logging:
      driver: none
    tty: true
    stdin_open: true
    privileged: True

  rosqrnode:
    container_name: "rosqrnode"
    networks:
      - rosnet
    depends_on:
      - master
    build:
      context: .
      target: rosqrnode
    environment:
      - "ROS_HOSTNAME=rosqrnode"
      - "ROS_MASTER_URI=http://master:11311"
    logging:
      driver: none
    tty: true
    stdin_open: true

networks:
  rosnet:
